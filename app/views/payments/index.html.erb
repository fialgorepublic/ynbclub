<div class="dashboard-holder">
  <div class="row">
    <div class="col-md-3">
      <%= render partial: "shared/side_bar" %>
    </div>
    <div class="col-md-9">
      <p id="notice"><%= notice %></p>

      <div class="row">
        <div class="col-md-12">
          <h3 class="card-header">View payment history</h3>
          <div class="input-group">
            <input type="text" id="searchText" style="height: 30px;" class="input-sm form-control ng-pristine ng-valid ng-touched" placeholder="Payment code / Recipient name / Email / Journal entry" autofocus="">
          <span class="input-group-btn">
            <button class="btn btn-sm btn-default" type="button" onclick="searchPerform();"><i class="fa fa-search"></i></button>
            <!-- ngIf: doSearch -->
          <a id="crossBtn" class="btn btn-sm btn-default ng-scope" href="/users" style="display: none;"><i class="fa fa-times"></i></a>
          </span>
          </div>
        </div>
        <div class="col-md-4">
          <h5>since</h5>
          <%= text_field_tag :since,nil, :class => 'form-control dateTime', :placeholder=>"Please select date since filter started" %>
        </div>
        <div class="col-md-4">
          <h5>To Date</h5>
          <%= text_field_tag :to_date,nil, :class => 'form-control dateTime', :placeholder=> "Please select date since filter ended" %>
        </div>
        <div class="col-md-4">
          <h5>Partner</h5>
          <%= collection_select(:user, :id, User.joins(:role).where("roles.name = 'Brand ambassador'"), :id, :name, {}, html_options = {:class=>"form-control", :multiple=>"multiple", :placeholder => "Tìm theo mã giới thiệu/tên partner"}) %>
        </div>
      </div>
      <div class="col-md-12 m-t-30">
        <a href="/payments" class="btn btn-info pull-right" style="margin-left: 5px;">Clear filter</a>
        <button onclick="apply_filter();" class="btn btn-info pull-right">Apply filter</button>
      </div>
      <br/>
      <br/>

      <div class="row m-t-30">
        <div class="col-md-12">
          <div class="card-body">
            <table id="bs4-table" class="table table-striped table-bordered" style="width:100%">
              <thead>
              <tr>
                <th>Payment code</th>
                <th>Payment date</th>
                <th>Amount</th>
                <th>Recipient name</th>
                <th>Email</th>
                <th>Number math</th>
                <th>Status</th>
                <th>Note</th>
              </tr>
              </thead>

              <tbody>
              <% @payments.each do |payment| %>
                  <tr>
                    <td><%= payment.payment_code %></td>
                    <td><%= payment.payment_date %></td>
                    <td><%= payment.amount %></td>
                    <td><%= payment.user.name %></td>
                    <td><%= payment.email %></td>
                    <td><%= payment.number_math %></td>
                    <td><%= payment.status %></td>
                    <td><%= payment.note %></td>
                    <!--<td><%#= link_to 'Show', payment %></td>-->
                    <!--<td><%#= link_to 'Edit', edit_payment_path(payment) %></td>-->
                    <!--<td><%#= link_to 'Destroy', payment, method: :delete, data: { confirm: 'Are you sure?' } %></td>-->
                  </tr>
              <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <br>

<%#= link_to 'New Payment', new_payment_path %>
    </div>
  </div>
</div>

<script>
    $(document).ready(
            function () {
                $("#user_id").select2();
            }
    );
    $(".dateTime").datepicker({
        format: "yyyy-mm-dd"
    });
    function apply_filter(){
        var since = $('#since').val();
        var to_date = $('#to_date').val();
        var user_ids = $('#user_id').val();
        if (since == "" && to_date == ""){

        }else{
            if (since != ""){
                if (to_date == ""){
                    alert("please select to date first.");
                    return false;
                }
            }
            if (to_date != ""){
                if (since == ""){
                    alert("please select to since first.");
                    return false;
                }
            }
        }
        window.location.href = '/payments?search[start_date]='+since+'&search[end_date]='+to_date+'&search[partner]='+user_ids;
    }
    function searchPerform(){
        var search = $('#searchText').val();
        window.location.href = '/payments?text='+search;
    }
</script>