<div class="col-md-9">
  <% if current_user.is_admin? %>
    <h1>All Orders</h1>
  <% else %>
    <h1>My Orders</h1>
  <% end %>
  <hr>
  <table class="table table-striped table-bordered" id="my-orders">
    <thead>
    <tr>
      <th>Date</th>
      <th>Order#(Shop)</th>
      <% if current_user.is_admin? %>
        <th>Tracking#(GHTK)</th>
        <th>Customer Name</th>
        <th>Phone Number</th>
        <th>Picked Phone</th>
        <th>Email</th>
        <th>Address</th>
        <th>Ward</th>
        <th>Province</th>
        <th>District</th>
        <th>City</th>
        <th>Country</th>
      <% end %>
      <th>Price</th>
      <th>Send To GHTK</th>
      <th>Tracking Link</th>
    </tr>
    </thead>

    <tbody>

    <% @orders.each do |order| %>
      <tr>
        <td><%= order_date(order) %></td>
        <td><%= order.order_name %></td>
        <% if current_user.is_admin? %>
          <td><%= order.ghtk_label %></td>
          <td><%= order.customer_name %></td>
          <td><%= order.phone_number %></td>
          <th><%= order.picked_phone? ? 'Yes' : 'No' %></th>
          <th><%= order.email %></th>
          <th><%= order.address %></th>
          <th><%= order.ward %></th>
          <th><%= order.province %></th>
          <th><%= order.district %></th>
          <th><%= order.city %></th>
          <th>Vietnam</th>
        <% end %>
        <td><%= number_with_delimiter(order.total, delimiter: ".") %>â‚«</td>
        <td>
          <% if order.sent_to_ghtk? %>
            Already Sent
          <% else %>
            <%= link_to 'Send To GHTK', 'Javascript:void(0);', class: 'send_to_ghtk', data: { order_id: order.id } %>
          <% end %>
        </td>
        <td><%= link_to 'Track Order(Shop)', order.tracking_link, target: :blank %></td>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>

<script type="text/javascript">
  $('.send_to_ghtk').click(function(){
    order_id = $(this).data('order_id');
    $('.loader').show();
    $.ajax({
      url: `orders/send_to_ghtk?id=${order_id}`,
      type: 'get',
      contentType: 'json',
      error: function () {
        $('.loader').hide();
        alert('Error');
      }
    });

  });
</script>
